<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love APP - 果实兑换</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- 顶部导航 -->
        <nav class="navbar">
            <a href="{{ url_for('index') }}" class="back-btn"><i class="fas fa-arrow-left"></i></a>
            <h1 class="logo">果实兑换</h1>
        </nav>

        <!-- 主内容区域 -->
        <main class="main-content">
            <section class="rewards-section">
                <!-- 果实数量展示 -->
                <div class="fruits-display">
                    <div class="fruits-count">
                        <i class="fas fa-apple-alt"></i> {{ fruits }}
                    </div>
                    <div class="fruits-label">可用果实</div>
                </div>
                
                <!-- 兑换选项 -->
                <div class="rewards-options">
                    <h2>可兑换的福利</h2>
                    
                    <div class="reward-items">
                        <!-- 和好券 -->
                        <div class="reward-item">
                            <div class="reward-icon">
                                <i class="fas fa-handshake"></i>
                            </div>
                            <div class="reward-info">
                                <h3>和好券</h3>
                                <p>吵架时一方可使用，触发"强制冷静+共同回忆美好瞬间"流程。</p>
                                <div class="reward-cost">
                                    <i class="fas fa-apple-alt"></i> 1
                                </div>
                            </div>
                            <button class="exchange-btn" data-reward="make_up" {% if fruits < 1 %}disabled{% endif %}>
                                兑换
                            </button>
                        </div>
                        
                        <!-- 心愿券 -->
                        <div class="reward-item">
                            <div class="reward-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="reward-info">
                                <h3>心愿券</h3>
                                <p>让对方满足自己一个小要求，如"陪我看一部电影""给我讲睡前故事"。</p>
                                <div class="reward-cost">
                                    <i class="fas fa-apple-alt"></i> 1
                                </div>
                            </div>
                            <button class="exchange-btn" data-reward="wish" {% if fruits < 1 %}disabled{% endif %}>
                                兑换
                            </button>
                        </div>
                        
                        <!-- 专属仪式券 -->
                        <div class="reward-item">
                            <div class="reward-icon">
                                <i class="fas fa-heart"></i>
                            </div>
                            <div class="reward-info">
                                <h3>专属仪式券</h3>
                                <p>触发情侣间约定的专属浪漫仪式，如"一起做一顿饭""周末短途旅行"。</p>
                                <div class="reward-cost">
                                    <i class="fas fa-apple-alt"></i> 1
                                </div>
                            </div>
                            <button class="exchange-btn" data-reward="ceremony" {% if fruits < 1 %}disabled{% endif %}>
                                兑换
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- 我的奖励 -->
                <div class="my-rewards">
                    <h2>我的奖励</h2>
                    <div id="rewards-list">
                        {% if rewards|length == 0 %}
                            <p class="no-rewards">还没有兑换任何奖励，快去兑换吧！</p>
                        {% else %}
                            {% for reward in rewards %}
                                <div class="my-reward-item {{ 'used' if reward.used }}">
                                    <div class="reward-name">{{ reward.name }}</div>
                                    <div class="reward-date">{{ reward.date }}</div>
                                    <div class="reward-status">
                                        {{ '已使用' if reward.used else '未使用' }}
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </section>
        </main>

        <!-- 页脚 -->
        <footer class="footer">
            <p>Love APP - 让爱更纯粹 ❤️</p>
        </footer>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // 兑换按钮点击事件
        document.querySelectorAll('.exchange-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                if (this.disabled) return;
                
                const rewardType = this.getAttribute('data-reward');
                
                // 创建表单数据
                const formData = new FormData();
                formData.append('reward_type', rewardType);
                
                // 发送兑换请求
                fetch('{{ url_for('exchange_reward') }}', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(data.message);
                        // 刷新页面
                        window.location.reload();
                    } else {
                        alert(data.message);
                    }
                });
            });
        });
    </script>
</body>
</html>