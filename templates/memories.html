<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love APP - 共同回忆</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- 顶部导航 -->
        <nav class="navbar">
            <a href="{{ url_for('index') }}" class="back-btn"><i class="fas fa-arrow-left"></i></a>
            <h1 class="logo">共同回忆</h1>
        </nav>

        <!-- 主内容区域 -->
        <main class="main-content">
            <section class="memories-section">
                <!-- 回忆相册 -->
                <div class="memories-album">
                    <div class="section-header">
                        <h2>回忆相册</h2>
                        <button id="add-memory-btn" class="add-btn">
                            <i class="fas fa-plus"></i> 添加回忆
                        </button>
                    </div>
                    
                    <!-- 回忆网格 -->
                    <div class="memories-grid">
                        {% if memories|length == 0 %}
                            <p class="no-memories">还没有回忆，快去添加第一个吧！</p>
                        {% else %}
                            {% for memory in memories %}
                                <div class="memory-item">
                                    <div class="memory-image">
                                        <!-- 默认图片，实际项目中应该使用上传的图片 -->
                                        <img src="https://via.placeholder.com/200?text={{ memory.title }}" alt="{{ memory.title }}">
                                    </div>
                                    <div class="memory-info">
                                        <h3>{{ memory.title }}</h3>
                                        <p>{{ memory.description }}</p>
                                        <div class="memory-tags">
                                            {% for tag in memory.tags %}
                                                <span class="tag">{{ tag }}</span>
                                            {% endfor %}
                                        </div>
                                        <div class="memory-date">{{ memory.date }}</div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
                
                <!-- 纪念日提醒 -->
                <div class="anniversaries-section">
                    <div class="section-header">
                        <h2>纪念日提醒</h2>
                        <button id="add-anniversary-btn" class="add-btn">
                            <i class="fas fa-calendar-plus"></i> 添加纪念日
                        </button>
                    </div>
                    
                    <div class="anniversaries-list">
                        {% if anniversaries|length == 0 %}
                            <p class="no-anniversaries">还没有添加纪念日，快去添加重要的日子吧！</p>
                        {% else %}
                            {% for anniversary in anniversaries %}
                                <div class="anniversary-item">
                                    <div class="anniversary-name">{{ anniversary.name }}</div>
                                    <div class="anniversary-date">{{ anniversary.date }}</div>
                                    <div class="anniversary-countdown">
                                        <!-- 这里可以添加倒计时功能 -->
                                        <span>还有 {{ (datetime.strptime(anniversary.date, '%Y-%m-%d') - datetime.now()).days }} 天</span>
                                    </div>
                                </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
            </section>
        </main>

        <!-- 页脚 -->
        <footer class="footer">
            <p>Love APP - 让爱更纯粹 ❤️</p>
        </footer>
    </div>

    <!-- 添加回忆模态框 -->
    <div id="memory-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加回忆</h3>
                <button id="close-memory-modal" class="close-btn">&times;</button>
            </div>
            <form id="memory-form" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="memory-title">标题：</label>
                    <input type="text" id="memory-title" name="title" required>
                </div>
                <div class="form-group">
                    <label for="memory-description">描述：</label>
                    <textarea id="memory-description" name="description"></textarea>
                </div>
                <div class="form-group">
                    <label for="memory-tags">标签（用逗号分隔）：</label>
                    <input type="text" id="memory-tags" name="tags">
                </div>
                <div class="form-group">
                    <label for="memory-image">图片：</label>
                    <input type="file" id="memory-image" name="image" accept="image/*">
                </div>
                <div class="form-actions">
                    <button type="submit" class="submit-btn">保存</button>
                    <button type="button" id="cancel-memory-btn" class="cancel-btn">取消</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 添加纪念日模态框 -->
    <div id="anniversary-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加纪念日</h3>
                <button id="close-anniversary-modal" class="close-btn">&times;</button>
            </div>
            <form id="anniversary-form">
                <div class="form-group">
                    <label for="anniversary-name">名称：</label>
                    <input type="text" id="anniversary-name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="anniversary-date">日期：</label>
                    <input type="date" id="anniversary-date" name="date" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="submit-btn">保存</button>
                    <button type="button" id="cancel-anniversary-btn" class="cancel-btn">取消</button>
                </div>
            </form>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        // 模态框控制
        const memoryModal = document.getElementById('memory-modal');
        const anniversaryModal = document.getElementById('anniversary-modal');
        
        // 添加回忆按钮
        document.getElementById('add-memory-btn').addEventListener('click', function() {
            memoryModal.style.display = 'flex';
        });
        
        // 添加纪念日按钮
        document.getElementById('add-anniversary-btn').addEventListener('click', function() {
            anniversaryModal.style.display = 'flex';
        });
        
        // 关闭模态框
        function closeModal(modal) {
            modal.style.display = 'none';
        }
        
        document.getElementById('close-memory-modal').addEventListener('click', function() {
            closeModal(memoryModal);
        });
        
        document.getElementById('cancel-memory-btn').addEventListener('click', function() {
            closeModal(memoryModal);
        });
        
        document.getElementById('close-anniversary-modal').addEventListener('click', function() {
            closeModal(anniversaryModal);
        });
        
        document.getElementById('cancel-anniversary-btn').addEventListener('click', function() {
            closeModal(anniversaryModal);
        });
        
        // 点击模态框外部关闭
        window.addEventListener('click', function(event) {
            if (event.target === memoryModal) {
                closeModal(memoryModal);
            }
            if (event.target === anniversaryModal) {
                closeModal(anniversaryModal);
            }
        });
        
        // 表单提交处理
        document.getElementById('memory-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch('{{ url_for('add_memory') }}', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    closeModal(memoryModal);
                    window.location.reload();
                } else {
                    alert(data.message);
                }
            });
        });
        
        document.getElementById('anniversary-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch('{{ url_for('add_anniversary') }}', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    closeModal(anniversaryModal);
                    window.location.reload();
                } else {
                    alert(data.message);
                }
            });
        });
    </script>
</body>
</html>